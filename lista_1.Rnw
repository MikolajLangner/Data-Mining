\documentclass{article}

\usepackage[OT4]{polski}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[top=2.5cm, bottom=2.5cm, left=2cm, right=2cm]{geometry}
\usepackage{graphicx}
\usepackage{float}
\usepackage[colorlinks=true, linkcolor=blue]{hyperref}
\usepackage{amsmath}
\usepackage{amssymb}

<<Globals, echo=FALSE, warning=FALSE>>=
library(knitr)
library(xtable)
opts_chunk$set(fig.path='figure/', fig.align='center', fig.pos='H',fig.width=5, fig.height=4)
@

\title{Lista 1}
\author{Miko≈Çaj Langner, Marcin Kostrzewa}
\date{31.3.2021}

\begin{document}
\maketitle

\section{Etap I}

<<Load and view data>>=
df <- read.csv('churn.txt')

dim(df)
head(df)
str(df)
@

<<Change types>>=
df$Area.Code <- as.factor(df$Area.Code)
df$Day.Charge <- as.integer(df$Day.Charge)
@

<<Check NAs>>=
sapply(df, function(x) sum(is.na(x)))
@

<<Delete `Phone` column>>=
df <- subset(df, select=-Phone)
@

<<Check levels>>=
sapply(df[, sapply(df, is.factor)], levels)
@

<<Summary data>>=
summary(df)
@

\section{Etap II}

<<Import libraries, warning=FALSE, message=FALSE>>=
library(ggplot2)
library(GGally)
library(tidyr)
library(dplyr)
@

<<Split data by numerics and factors>>=
factors <- subset(df, select=sapply(df, is.factor))
numerics <- subset(df, select=sapply(df, function(x) !is.factor(x)))
@

\begin{description}


\item{a)}

<<Summary statistics>>=
extended.summary <- function(X) {
    c(mean = mean(X), trimmed.mean = mean(X, trim=.0025), min = min(X), Q1 = quantile(X, .25, names=F), median = median(X), Q3 = quantile(X, .75, names=F), max = max(X), range = range(X), sd = sd(X), IQR = IQR(X))
}

sapply(numerics, extended.summary)
@


\item{b)}

<<Overviews plots, warning=FALSE, message=FALSE>>=
ggplot(gather(factors), aes(value)) +
  geom_bar() +
  facet_wrap(~key, scales='free')

ggplot(gather(numerics), aes(value)) +
  geom_histogram() +
  facet_wrap(~key, scales='free')

ggplot(gather(numerics), aes(value)) +
  geom_boxplot() +
  facet_wrap(~key, scales='free')
@

\item{c)}

<<Pair plot for continuous variables>>=
continuous <- subset(numerics, select=sapply(numerics, function(x) !is.integer(x)))
ggpairs(continuous)
@

\item{d)}

<<Identify ranges>>=
sapply(numerics, range)
@

<<Identify levels>>=
sapply(factors, levels)
@

<<Identify symmetry>>=
library(moments)
sapply(numerics, skewness)
@

<<Identify coefficient of variation>>=
cv <- function(X) sd(X) / mean(X)

sapply(numerics, cv)
@

\end{description}

\section{Etap III}

\begin{description}

\item{a)}

<<Add grouping category to numerics>>=
numerics <- data.frame(numerics, Churn. = df$Churn.)
@

<<Summary statistics grouped>>=
aggregate(. ~ Churn., numerics, extended.summary)
@

<<Overviews plots grouped, warning=FALSE, message=FALSE>>=
ggplot(gather(factors, "key", "value", -Churn.), aes(value, color=Churn.)) +
  geom_bar(position='dodge') +
  facet_wrap(~key, scales='free')

ggplot(gather(numerics, "key", "value", -Churn.), aes(value, color=Churn.)) +
  geom_histogram() +
  facet_wrap(~key, scales='free')

ggplot(gather(numerics, "key", "value", -Churn.), aes(value, color=Churn.)) +
  geom_boxplot() +
  facet_wrap(~key, scales='free')
@

<<Pair plot for continuous variables grouped>>=
continuous <- subset(numerics, select=sapply(numerics, function(x) !is.integer(x)))
continuous %>% ggpairs(., 
               mapping = ggplot2::aes(color=Churn.),
               legend=1,
               columns=1:7)
@

<<Identify ranges grouped>>=
aggregate(. ~ Churn., numerics, range)
@

<<Identify levels grouped>>=
aggregate(. ~ Churn., factors, levels)
@

<<Identify symmetry grouped>>=
aggregate(. ~ Churn., numerics, skewness)
@

<<Identify coefficient of variation grouped>>=
aggregate(. ~ Churn., numerics, cv)
@

\item{b)}

\end{description}

\section{Etap IV}

\end{document}